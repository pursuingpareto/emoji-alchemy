//
//  CombinationModel.swift
//  Emoji
//
//  Created by Andrew Brown on 4/3/15.
//  Copyright (c) 2015 Andy Brown. All rights reserved.
//

import Foundation
import UIKit

class CombinationModel {
    
    var comboDict : [NSString : NSString] = [:]
    
    var accessibleEmoji : Set<NSString> = Set<NSString>()
    
    // NOTE(ih) tried to maked isAccessible a closure in setAccessbileEmoji, but had problems making closure recursive
    var visitedCombo : Set<NSString> = Set<NSString>()
    
    let fundamentalEmoji = ["üî•", "üíß", "üí®", "üåé", "üåÄ"]
    
    let emojiToText : [NSString: NSString] = [
        "üî•": "fire",
        "üíß": "water",
        "üí®": "air",
        "üåé": "earth",
        "üåÄ": "space",
        "‚è≥": "time",
        "‚ö°Ô∏è": "energy",
        "üåã": "destruction",
        "‚òÄÔ∏è": "sun",
        "‚ùÑÔ∏è": "snow",
        "üå±": "life",
        "‚ù§Ô∏è": "love",
        "üé∂": "harmony",
        "‚òØ": "balance",
        "üåë": "moon",
        "üë§": "human",
        "üîã": "electricity",
        "üë®": "man",
        "üí£": "bomb",
        "üåä": "wave",
        "üåà": "rainbow",
        "üåÖ": "sunrise",
        "‚≠êÔ∏è": "star",
        "üë©": "woman",
        "üòê": "emotion",
        "üòë": "indifference",
        "üêæ": "animal",
        "üëΩ": "alien",
        "üí™": "strength",
        "üé®": "art",
        "üé≤": "chance",
        "üí¶": "conservation",
        "‚òîÔ∏è": "rain",
        "üéº": "music",
        "‚ôªÔ∏è": "cycle",
        "üåå": "universe",
        "üîÉ": "rotation",
        "üöÄ": "exploration",
        "üë•": "people",
        "üîº": "change",
        "üìà": "increase",
        "üíÄ": "death",
        "üîß": "tool",
        "üî´": "weapon",
        "üî¨": "science",
        "üîÆ": "belief",
        "üëç": "good",
        "üòÄ": "happiness",
        "üò†": "anger",
        "üòé": "confidence",
        "üòÆ": "awe",
        "üêí": "curiosity",
        "üòå": "compassion",
        "üòç": "in love",
        "‚ò∫Ô∏è": "content",
        "üòá": "innocence",
        "‚úåÔ∏è": "peace",
        "üò•": "sad",
        "üëé": "bad",
        "üôà": "self-deception",
        "üìâ": "decrease",
        "üí°": "thought",
        "üéÖ": "santa",
        "üèÑ": "surf",
        "‚òÅÔ∏è": "cloud",
        "‚õÑÔ∏è": "snowman",
        "üå≤": "tree",
        "üîµ": "oxygen",
        "‚úä": "war",
        "üîä": "sound",
        "üîÜ": "light",
        "üí¨": "communication",
        "üí≠": "thought",
        "‚ô®Ô∏è": "heat",
        "üíã": "lust",
        "‚õΩÔ∏è": "fuel",
        "üêü": "fish",
        "üêù": "bee",
        "‚ìÇÔ∏è": "mass",
        "üçé": "gravity",
        "‚¨õÔ∏è": "darkness",
        "üòõ": "playful",
        "üì°": "radio wave",
        "üê£": "rebirth",
        "üÖøÔ∏è": "pressure",
        "‚ö´Ô∏è": "black hole",
        "‚ú≥Ô∏è": "chaos",
        "üî¢": "numbers",
        "üî§": "language",
        "üåæ": "agriculture",
        "üè≠": "industry",
        "üíí": "marriage",
        "üëÄ": "vision",
        "üìú": "history",
        "‚ùì": "uncertainty",
        "üî≠": "observation",
        "üëª": "ghost",
        "üîÅ": "circulation",
        "üë∂": "baby",
        "üéà": "gas",
        "üöÇ": "engine",
        "üè¢": "structure"
    ]
    
    let normal_combos : [[NSString]] = [
        ["   ","üî•","üíß","üåé","üí®","üåÄ","‚òØ" ,"‚ö°Ô∏è","üå±","‚ù§Ô∏è","üòê","üë§","üîÜ","üí≠","‚ôªÔ∏è","‚è≥","üîß","‚ô®Ô∏è","üí™","üíã","üò†","üë®","‚õΩÔ∏è","üêü","üêí","üë©","üîã","üêæ","üí¶","üòé","üîä","üêù","üòå","üçé","üëΩ","üòÆ","‚≠êÔ∏è","‚ìÇÔ∏è","üíÄ","üí≠","‚¨õÔ∏è","üòõ","üì°"],
        
        ["üî•","   ","‚òØ" ,"‚ö°Ô∏è","‚ù§Ô∏è","üîÜ","üíß","‚ô®Ô∏è","üí™","üíã","üò†","üë®","   ","‚úä","  ","  ","  ","  " ,"   ","  ","  ","  ","üåã","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  "],
        ["üíß","   ","  ","üå±","üòê","üí≠","üî•","‚õΩÔ∏è","üêü","  ","üêí","üë©","üåà","üé®" ,"  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  ","  "],
        ["üåé","   ","  ","  ","üë§","‚ôªÔ∏è","üí®","üîã","üêæ","üí¶","üòé","üîß","   ","üî¨","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   " ,"  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  ","  "],
        ["üí®","   ","  ","  ","   ","‚è≥","üåé","üîä","üêù","  ","üòå","üëª","   ","üî§","  ","  ","  ","üîÅ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  "],
        ["üåÄ","   ","  ","  ","   ","  ","‚è≥","üçé","üëΩ","  ","üòÆ","üöÄ","‚≠êÔ∏è","üî¢","  ","üåå","  " ,"   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  ","  "],
        ["‚òØ" ,"   ","  ","  ","   ","  ","  ","‚ìÇÔ∏è","üíÄ","  ","üí≠","  ","‚¨õÔ∏è","üòê" ,"  ","üåÄ","  ","   ","  ","  ","  " ,"   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  ","  "],
        ["‚ö°Ô∏è","   ","  ","  ","   ","  ","  ","  ","   ","  ","üòõ","  ","üì°","üè≠","  ","‚ùì","  ","   ","  ","  ","  " ,"   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  ","  "],
        ["üå±","   ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","üåæ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  ","  "],
        ["‚ù§Ô∏è","   ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","üíí","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  ","  "],
        ["üòê","   ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  ","  "],
        ["üë§","   ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","üí∞","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  ","  "],
        ["üîÜ","   ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","üëÄ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  ","  "],
        ["üí≠","   ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  ","  "],
        ["‚ôªÔ∏è","   ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  ","  "],
        ["‚è≥","   ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","üìú","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  ","  "],
        ["üîß","   ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  ","  "],
        ["‚ô®Ô∏è","   ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  ","  "],
        ["üí™","   ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  ","  "],
        ["üíã","   ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  ","  "],
        ["üò†","   ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  ","  "],
        ["üë®","   ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  ","  "],
        ["‚õΩÔ∏è","   ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  ","  "],
        ["üêü","   ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  ","  "],
        ["üêí","   ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  ","  "],
        ["üë©","   ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","   ","  ","  ","   ","üë∂","   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  "],
        ["üîã","   ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","   ","  ","  ","  ","  ","  ", "  ","   ","  ","  ","  ", "  ","  ","  ","  ","   ","  ","  "],
    ]
    
    let cycles = [
        ["üî•", "üåã", "üê£"],
        ["üíß", "‚òÅÔ∏è", "‚òîÔ∏è"],
        ["üí®", "üÖøÔ∏è", "‚ö°Ô∏è", "üéà"],
        ["üåé", "üå±", "üíÄ"],
        ["üåÄ", "üìà", "üåå", "üìâ", "‚ö´Ô∏è"],
        ["‚òØ",  "‚ú≥Ô∏è"],
        ["‚ù§Ô∏è", "üòë", "üí¨", "üòå"]
    ]

    let combinations : [(NSString, NSString, NSString)] = [
        ("üåÄ", "üåé", "‚è≥"),
        ("üî•", "üíß", "‚òØ"),
        ("üî•", "üí®", "‚ö°Ô∏è"),
        ("üî•", "üåé", "üåã"),
        ("üî•", "üåÄ", "‚òÄÔ∏è"),
        ("üíß", "üí®", "‚ùÑÔ∏è"),
        ("üíß", "üåé", "üå±"),
        ("üíß", "üåÄ", "üåë"),
        ("üí®", "üåé", "‚ù§Ô∏è"),
        ("üí®", "üåÄ", "üé∂"),
        //        ("üåé", "‚è≥"),
        ("üåÄ", "‚è≥", "üåå"),
        ("üî•", "‚ö°Ô∏è", "üí£"),
        ("üíß", "‚ö°Ô∏è", "üåä"),
        ("üåé", "‚ö°Ô∏è", "üîã"),
        ("üíß", "üåã", "üåä"),
        ("üíß", "‚òÄÔ∏è", "üåà"),
        ("üåé", "‚òÄÔ∏è", "üåÖ"),
        ("üåÄ", "‚òÄÔ∏è", "‚≠êÔ∏è"),
        ("üî•", "‚ùÑÔ∏è", "üíß"),
        //        ("üåé", "‚ùÑÔ∏è"),
        // TODO : Only get to man / woman through human
        ("üî•", "üå±", "üë®"),
        ("üíß", "üå±", "üë©"),
        ("üí®", "üå±", "üòê"),
        ("üåé", "üå±", "üë§"),
        ("üåÄ", "üå±", "üëΩ"),
        ("üî•", "‚ù§Ô∏è", "üí™"),
        ("üíß", "‚ù§Ô∏è", "üé®"),
        ("üí®", "‚ù§Ô∏è", "üé≤"),
        ("üåé", "‚ù§Ô∏è", "üëç"),
        ("üåÄ", "‚ù§Ô∏è", "üîÆ"),
        ("üíß", "üé∂", "‚òîÔ∏è"),
        ("üí®", "üé∂", "üéº"),
        ("üåé", "üé∂", "‚ôªÔ∏è"),
        ("üåÄ", "üé∂", "üåå"),
        ("üî•", "‚òØ", "üíß"),
        ("üíß", "‚òØ", "üî•"),
        ("üí®", "‚òØ", "üåé"),
        ("üåé", "‚òØ", "üí®"),
        ("üåÄ", "‚òØ", "‚è≥"),
        ("üåé", "üåë", "üîÉ"),
        ("üåÄ", "üåë", "üöÄ"),
        ("üå±", "‚ù§Ô∏è", "üòÄ"),
        ("üåã", "‚ù§Ô∏è", "‚òØ"),
        ("üë§", "üë§", "üë•"),
        ("üå±", "‚è≥", "üìà"),
        ("üå±", "üåã", "üíÄ"),
        ("üë§", "üåé", "üîß"),
        ("üë§", "üî•", "üî™"),
        ("üë§", "üåÄ", "üöÄ"),
        ("üë§", "üíß", "üî¨"),
        ("üë§", "üí®", "üîÆ"),
        ("üë§", "‚ù§Ô∏è", "üëç"),
        ("üë§", "‚è≥", "üíÄ"),
        ("üòê", "üëç", "üòÄ"),
        ("üòê", "üî•", "üò†"),
        ("üòê", "üåé", "üòé"),
        ("üòê", "üåÄ", "üòÆ"),
        ("üòê", "üíß", "üêí"),
        ("üòê", "üí®", "üòå"),
        ("üòê", "‚è≥", "‚ù§Ô∏è"),
        ("üòê", "‚ù§Ô∏è", "üòç"),
        ("üòê", "‚òØ", "‚ò∫Ô∏è"),
        ("üòê", "üé∂", "üòá"),
        ("üòê", "üëé", "üò•"),
        ("‚ùÑÔ∏è", "üîÆ", "üéÖ"),
        ("‚òØ", "üåä", "üèÑ"),
        ("üíß", "‚ôªÔ∏è", "‚òÅÔ∏è"),
        ("‚ôªÔ∏è", "‚òÅÔ∏è", "‚òîÔ∏è"),
        ("‚òîÔ∏è", "‚ôªÔ∏è", "üíß"),
        ("‚è≥", "üåé", "üåã"),
        ("‚ùÑÔ∏è", "üå±", "‚õÑÔ∏è"),
        ("‚òÄÔ∏è", "üå±", "üå≤"),
        ("‚òÄÔ∏è", "üå≤", "üîµ"),
        ("‚òÄÔ∏è", "‚òØ", "üåë"),
        ("‚òØ", "üåë", "‚òÄÔ∏è"),
        ("‚òØ", "üåã", "üé®"),
        ("‚òØ", "üé®", "üåã"),
        ("‚ù§Ô∏è", "üé∂", "‚úåÔ∏è"),
        ("‚òØ", "‚úåÔ∏è", "‚úä"),
        ("‚òØ", "‚úä", "‚úåÔ∏è"),
        ("‚ö°Ô∏è", "üí®", "üîä"),
        ("üé∂", "üîä", "üéº"),
        // TODO : Ask for push notifications when communication discovered.
        ("üé∂", "üí®", "üí¨"),
        ("‚ö°Ô∏è", "üåÄ", "üîÜ"),
    ]

    func makeComboDict() -> [NSString : NSString] {
        let first_row = self.normal_combos[0]
        var cDict : [NSString: NSString] = [:]
        let whitespaceSet = NSCharacterSet.whitespaceCharacterSet()
        var e1 = ""
        // add combos from grid
        for (i, row) in enumerate(self.normal_combos) {
            if (i == 0) {
                continue
            }
            e1 = row[0] as String
            for (j, res) in enumerate(row) {
                if (j == 0) {
                    continue
                }
                if res.stringByTrimmingCharactersInSet(whitespaceSet) != "" {
                    var e2 = first_row[j]
                    var key1 = (e1 as String) + (e2 as String)
                    var key2 = (e2 as String) + (e1 as String)
                    cDict[key1] = res
                    cDict[key2] = res
                }
            }
        }
        
        // add combos from cycles
        for cycle in self.cycles {
            var N = cycle.count
            for i in 0...N {
                var e1 = cycle[i % N]
                var e2 = "‚ôªÔ∏è"
                var res = cycle[(i+1) % N]
                var key1 = (e1 as String) + (e2 as String)
                var key2 = (e2 as String) + (e1 as String)
                cDict[key1] = res
                cDict[key2] = res
            }
        }
        return cDict
    }
    
    func setAccessibleEmoji() {
        self.accessibleEmoji = Set(self.comboDict.values)
    }
    
    init() {
//        self.comboDict = makeComboDict(self.combinations)
        self.comboDict = makeComboDict()
        setAccessibleEmoji()
        for row in self.normal_combos{
            var r_string = ""
            for e in row {
                r_string += (e as String) + ","
            }
        }
    }

}
